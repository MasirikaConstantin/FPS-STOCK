{"version":3,"file":"Accueil-Dv5635hH.js","sources":["../../../resources/js/pages/Admin/Permissions/Accueil.tsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { BreadcrumbItem } from \"@/types\";\nimport AppLayout from \"@/layouts/app-layout\";\nimport { Head, Link ,router} from \"@inertiajs/react\";\nimport { Permission, UserPermission } from \"@/types/permissions\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { DialogDescription } from \"@radix-ui/react-dialog\";\nimport { toast } from \"sonner\";\n\ninterface Props {\n    permissions: {\n      id: number;\n      name: string;\n      description: string;\n      module: string;\n      action: string;\n      ref:string;\n      users?: {\n        id: number;\n        name: string;\n        email: string;\n      }[];\n    }[];\n    userPermissions?: {\n      user_id: number;\n      permission_id: number;\n      user: {\n        id: number;\n        name: string;\n        email: string;\n      };\n    }[];\n  }\n  \nexport default function Accueil({ permissions, userPermissions }: Props) {\n    const [selectedPermission, setSelectedPermission] = useState<Permission | null>(null);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n\n  const breadcrumbs: BreadcrumbItem[] = [\n    {\n      title: 'Accueil',\n      href: route('dashboard'),\n    },\n    {\n      title: 'Gestion des Permissions',\n      href: route('admin.permissions.index'),\n    },\n  ];\n\n  const getUsersForPermission = (permissionId: number) => {\n    const permission = permissions.find(p => p.id === permissionId);\n    return permission?.users || [];\n  };\n\n  // Version 2: Si vous utilisez userPermissions séparés\n  const getUsersForPermissionAlt = (permissionId: number) => {\n    if (!userPermissions) return [];\n    return userPermissions\n      .filter(up => up.permission_id === permissionId)\n      .map(up => up.user)\n      .filter(Boolean);\n  };\n  const openUserModal = (permission: Permission) => {\n    setSelectedPermission(permission);\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = (permissionId: number) => {\n    if (confirm('Êtes-vous sûr de vouloir supprimer cette permission ?')) {\n      router.delete(route('admin.permissions.destroy', permissionId), {\n        preserveScroll: true,\n        onSuccess: () => {\n          // Vous pouvez ajouter une notification ici si besoin\n          toast.success('Permission supprimée avec succès');\n        },\n        onError: () => {\n          alert('Une erreur est survenue lors de la suppression');\n        }\n      });\n    }\n  };\n  const getUsers = userPermissions ? getUsersForPermissionAlt : getUsersForPermission;\n\n\n  return (\n    <AppLayout breadcrumbs={breadcrumbs}>\n      <Head title=\"Gestion des Permissions\" />\n\n\n      <div className=\"p-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Gestion des Permissions</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex justify-end mb-4\">\n              <Button asChild>\n                <Link href={route('admin.permissions.create')}>Ajouter une Permission</Link>\n              </Button>\n            </div>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Nom</TableHead>\n                  <TableHead>Description</TableHead>\n                  <TableHead>Utilisateurs</TableHead>\n                  <TableHead>Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {permissions.map((permission) => {\n                    const permissionUsers = getUsers(permission.id);\n                    return (\n                    <TableRow key={permission.id}>\n                      <TableCell className=\"font-medium\">{permission.name}</TableCell>\n                      <TableCell>{permission.description}</TableCell>\n                      <TableCell>\n                        {permissionUsers.length > 0 ? (\n                          <Button \n                            variant=\"ghost\" \n                            size=\"sm\"\n                            onClick={() => openUserModal(permission)}\n                            >\n                            Voir {permissionUsers.length} utilisateur(s)\n                          </Button>\n                        ) : (\n                          <span className=\"text-muted-foreground\">Aucun utilisateur</span>\n                        )}\n                      </TableCell>\n                      <TableCell className=\"flex space-x-2\">\n                        <Button asChild variant=\"outline\" size=\"sm\">\n                          <Link href={route('admin.permissions.edit', permission.ref)}>\n                            Modifier \n                          </Link>\n                        </Button>\n                        <Button variant=\"destructive\" size=\"sm\"\n                              onClick={() => handleDelete(permission.id)}>\n                          Supprimer\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n\n        {/* Modal pour afficher les utilisateurs */}\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n            <DialogContent>\n                <DialogHeader>\n                <DialogTitle>\n                    Utilisateurs avec la permission: {selectedPermission?.name}\n                </DialogTitle>\n                {/* Ajoutez ce composant Description */}\n                <DialogDescription>\n                    Liste des utilisateurs ayant cette permission\n                </DialogDescription>\n                </DialogHeader>\n                <div className=\"space-y-2\">\n                {selectedPermission && getUsersForPermission(selectedPermission.id).map(user => (\n                    <div key={user.id} className=\"flex items-center justify-between p-2 border rounded\">\n                    <div>\n                        <p className=\"font-medium\">{user.name}</p>\n                        <p className=\"text-sm text-muted-foreground\">{user.email}</p>\n                    </div>\n                    <Badge variant=\"outline\">ID: {user.id}</Badge>\n                    </div>\n                ))}\n                </div>\n            </DialogContent>\n            </Dialog>\n      </div>\n    </AppLayout>\n  );\n}"],"names":["Accueil","permissions","userPermissions","selectedPermission","setSelectedPermission","useState","isDialogOpen","setIsDialogOpen","breadcrumbs","getUsersForPermission","permissionId","permission","p","getUsersForPermissionAlt","up","openUserModal","handleDelete","router","toast","getUsers","jsxs","AppLayout","jsx","Head","Card","CardHeader","CardTitle","CardContent","Button","Link","Table","TableHeader","TableRow","TableHead","TableBody","permissionUsers","TableCell","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","user","Badge"],"mappings":"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"}