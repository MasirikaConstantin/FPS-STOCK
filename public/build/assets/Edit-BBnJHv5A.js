import{m as C,j as e,L as $,$ as w,t as g}from"./app-CQvyAInf.js";import{A as V}from"./app-layout-mQZNAdUE.js";import{B as m}from"./button-qelRmArg.js";import{I as E}from"./input-Blf29Qex.js";import{L as d}from"./label-DXuQz94P.js";import{S as p,a as u,b as h,c as x,d as n}from"./select-DsVvSlVc.js";import{T as F}from"./textarea-Ck1X0zwf.js";import"./app-CbyD8i4Z.js";import"./index-Dh4Dnqzu.js";import"./utils-jAU0Cazi.js";import"./createLucideIcon-CDtDhRNb.js";import"./index-Csg-B5yo.js";import"./index-B6QC96uA.js";import"./app-logo-icon-CYEPLqCw.js";import"./car-front-3ODHaHDz.js";import"./package-BH85mpxF.js";import"./index-D1Z7h3vH.js";import"./check-3WY5HJZB.js";function Y({transfert:a,hopitals:_,stocks:f}){const{data:t,setData:c,put:S,processing:v,errors:r}=C({from_hospital_id:a.from_hospital_id.toString(),to_hospital_id:a.to_hospital_id.toString(),priorite:a.priorite,notes:a.notes||"",articles:a.articles.map(s=>({stock_id:s.stock_id.toString(),medical_produit_id:s.medical_produit_id.toString(),quantite:s.quantite,ref:s.ref}))}),N=[{title:"Transferts de Stock",href:"/transferts"},{title:`Modifier ${a.ref}`,href:`/transferts/${a.ref}/edit`}],y=s=>{s.preventDefault(),S(route("transferts.update",a.ref),{onSuccess:()=>{g.success("Transfert mis à jour avec succès")},onError:()=>{g.error("Une erreur est survenue lors de la mise à jour")}})},b=()=>{c("articles",[...t.articles,{stock_id:"",medical_produit_id:"",quantite:1}])},q=s=>{const i=[...t.articles];i.splice(s,1),c("articles",i)},j=(s,i,l)=>{const o=[...t.articles];o[s]={...o[s],[i]:l},c("articles",o)},A=f.filter(s=>{var i;return((i=s.hopital_id)==null?void 0:i.toString())===t.from_hospital_id});return e.jsxs(V,{breadcrumbs:N,children:[e.jsx($,{title:`Modifier ${a.ref}`}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden shadow-sm sm:rounded-lg",children:e.jsx("div",{className:"p-6",children:e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"from_hospital_id",children:"Hôpital source*"}),e.jsxs(p,{value:t.from_hospital_id,onValueChange:s=>c("from_hospital_id",s),required:!0,children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Sélectionner un hôpital"})}),e.jsx(x,{children:_.map(s=>e.jsx(n,{value:s.id.toString(),children:s.nom},s.id))})]}),r.from_hospital_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.from_hospital_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"to_hospital_id",children:"Hôpital destination*"}),e.jsxs(p,{value:t.to_hospital_id,onValueChange:s=>c("to_hospital_id",s),required:!0,children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Sélectionner un hôpital"})}),e.jsx(x,{children:_.map(s=>e.jsx(n,{value:s.id.toString(),children:s.nom},s.id))})]}),r.to_hospital_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.to_hospital_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"priorite",children:"Priorité*"}),e.jsxs(p,{value:t.priorite,onValueChange:s=>c("priorite",s),required:!0,children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Sélectionner une priorité"})}),e.jsxs(x,{children:[e.jsx(n,{value:"faible",children:"Faible"}),e.jsx(n,{value:"moyen",children:"Moyen"}),e.jsx(n,{value:"eleve",children:"Élevé"}),e.jsx(n,{value:"urgent",children:"Urgent"})]})]}),r.priorite&&e.jsx("p",{className:"text-sm text-red-500",children:r.priorite})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"notes",children:"Notes"}),e.jsx(F,{id:"notes",value:t.notes,onChange:s=>c("notes",s.target.value),placeholder:"Informations supplémentaires (optionnel)",rows:3}),r.notes&&e.jsx("p",{className:"text-sm text-red-500",children:r.notes})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(d,{children:"Articles à transférer*"}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:b,disabled:!t.from_hospital_id,children:"Ajouter un article"})]}),t.articles.length>0?e.jsx("div",{className:"space-y-4",children:t.articles.map((s,i)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Stock source*"}),e.jsxs(p,{value:s.stock_id,onValueChange:l=>{const o=f.find(k=>k.id.toString()===l);j(i,"stock_id",l),o&&j(i,"medical_produit_id",o.medical_produit_id.toString())},required:!0,children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Sélectionner un stock"})}),e.jsx(x,{children:A.map(l=>{var o;return e.jsxs(n,{value:l.id.toString(),children:[(o=l.medical_produit)==null?void 0:o.name," (Quantité: ",l.quantite,")"]},l.id)})})]}),r[`articles.${i}.stock_id`]&&e.jsx("p",{className:"text-sm text-red-500",children:r[`articles.${i}.stock_id`]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Quantité*"}),e.jsx(E,{type:"number",min:"1",value:s.quantite,onChange:l=>j(i,"quantite",parseInt(l.target.value)),required:!0}),r[`articles.${i}.quantite`]&&e.jsx("p",{className:"text-sm text-red-500",children:r[`articles.${i}.quantite`]})]}),e.jsx("div",{children:e.jsx(m,{type:"button",variant:"destructive",size:"sm",onClick:()=>q(i),children:"Supprimer"})})]},i))}):e.jsx("div",{className:"text-center text-gray-500 py-4",children:t.from_hospital_id?"Aucun article ajouté au transfert":"Veuillez d'abord sélectionner un hôpital source"})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(m,{variant:"outline",asChild:!0,children:e.jsx(w,{href:route("transferts.index"),children:"Annuler"})}),e.jsx(m,{type:"submit",disabled:v||t.articles.length===0,children:v?"Enregistrement...":"Enregistrer"})]})]})})})})})]})}export{Y as default};
//# sourceMappingURL=Edit-BBnJHv5A.js.map
