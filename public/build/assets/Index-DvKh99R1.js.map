{"version":3,"file":"Index-DvKh99R1.js","sources":["../../../resources/js/pages/StocksCentral/Index.tsx"],"sourcesContent":["import {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from '@/components/ui/alert-dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from '@/components/ui/dropdown-menu';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport AppLayout from '@/layouts/app-layout';\nimport { BreadcrumbItem, User } from '@/types';\nimport { App, PageProps } from '@/types/types';\nimport { Head, Link, router } from '@inertiajs/react';\nimport { Eye, MoreHorizontal, Pencil, Trash2, Box, PackageCheck, PackageX } from 'lucide-react';\nimport { useState } from 'react';\nimport { toast } from 'sonner';\nimport { format } from 'date-fns';\nimport { fr } from 'date-fns/locale';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n\nexport default function Index({ stocks, produits, hopitals, auth }: PageProps<{ \n    stocks: App.Stock[],\n    produits: App.MedicalProduit[],\n    hopitals: App.Hopital[],\n    auth: User\n}>) {\n    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n    const [stockToDelete, setStockToDelete] = useState<App.Stock | null>(null);\n    const [openDropdownId, setOpenDropdownId] = useState<string | null>(null);\n\n    const breadcrumbs: BreadcrumbItem[] = [\n        {\n            title: 'Gestion des Stocks Central Central',\n            href: '/stocks',\n        },\n    ];\n\n    const handleDelete = (stock: App.Stock) => {\n        setStockToDelete(stock);\n        setDeleteDialogOpen(true);\n        setOpenDropdownId(null);\n    };\n\n    const confirmDelete = () => {\n        if (!stockToDelete) return;\n\n        router.delete(route('central-stocks.destroy', stockToDelete.ref), {\n            preserveScroll: true,\n            onSuccess: () => {\n                toast.success('Entrée de stock supprimée avec succès');\n                setDeleteDialogOpen(false);\n            },\n            onError: () => {\n                toast.error('Une erreur est survenue lors de la suppression');\n            },\n            onFinish: () => {\n                setOpenDropdownId(null);\n            },\n        });\n    };\n\n    const formatDate = (dateString: string | null) => {\n        if (!dateString) return '-';\n        return format(new Date(dateString), 'dd MMM yyyy', { locale: fr });\n    };\n\n    const getProduitName = (id: number) => {\n        return produits.find(p => p.id === id)?.name || 'Inconnu';\n    };\n\n    const getHopitalName = (id: number | null) => {\n        if (!id) return 'Stock central';\n        return hopitals.find(h => h.id === id)?.nom || 'Inconnu';\n    };\n\n    const getStatusBadge = (status: string) => {\n        switch (status) {\n            case 'disponible':\n                return <Badge variant=\"default\"><PackageCheck className=\"mr-1 h-3 w-3\" /> Disponible</Badge>;\n            case 'reservee':\n                return <Badge variant=\"secondary\"><Box className=\"mr-1 h-3 w-3\" /> Réservée</Badge>;\n            case 'expirer':\n                return <Badge variant=\"destructive\"><PackageX className=\"mr-1 h-3 w-3\" /> Expiré</Badge>;\n            case 'endommage':\n                return <Badge variant=\"destructive\">Endommagé</Badge>;\n            default:\n                return <Badge variant=\"outline\">Inconnu</Badge>;\n        }\n    };\n    const canCreateStock = auth.user.permissions.some(p => p.action === 'create' && p.module === 'stocks');\n    const isAdminCentral = auth.user.role === 'admin_central';\n\n    return (\n        <AppLayout breadcrumbs={breadcrumbs}>\n            <Head title=\"Gestion des Stocks Central\" />\n\n            <div className=\"py-12\">\n                <div className=\"mx-auto max-w-7xl sm:px-6 lg:px-8\">\n                    <div className=\"overflow-hidden shadow-sm sm:rounded-lg\">\n                        <Card>\n                            <CardHeader className=\"flex justify-between items-center mb-6\">\n                                <CardTitle className=\"text-2xl font-bold\">Gestion des Stocks Central</CardTitle>\n                                {canCreateStock ? (\n                                   <div className=\"flex gap-2\">\n                                    <Button asChild>\n                                        <Link href={route('central-stocks.create')}>Ajouter une entrée</Link>\n                                    </Button>\n                                    <Button variant=\"outline\" asChild>\n                                        <Link href={route('stock.entree.activite')}>Activité d'entrée</Link>\n                                    </Button>\n                                   </div>\n\n                                ):\n                                isAdminCentral ? (\n                                    <div className=\"text-red-500 text-sm font-bold w-1/2\">\n                                        <p>Vous êtes connecté en tant qu'admin central, Mais ne pouvez pas créer des stocks, vous devez ajouter des permissions pour y accéder</p>\n                                    </div>\n                                ):null}\n                            </CardHeader>\n                            <CardContent>\n                            \n\n                            <Table className=\"dark:text-gray-400cell w-full text-left text-sm text-gray-500 rtl:text-right\">\n                                <TableHeader>\n                                    <TableRow>\n                                        <TableHead>Produit</TableHead>\n                                        <TableHead>Quantité</TableHead>\n                                        <TableHead>Numéro de lot</TableHead>\n                                        <TableHead>Date expiration</TableHead>\n                                        <TableHead>Prix unitaire</TableHead>\n                                        <TableHead>Date réception</TableHead>\n                                        <TableHead>Statut</TableHead>\n                                        <TableHead>Actions</TableHead>\n                                    </TableRow>\n                                </TableHeader>\n                                <TableBody>\n                                    {stocks && stocks.length > 0 ? (\n                                        stocks.map((stock) => (\n                                            <TableRow key={stock.id}>\n                                                <TableCell className=\"font-medium text-black dark:text-white\">\n                                                    {getProduitName(stock.medical_produit_id)}\n                                                </TableCell>\n                                                <TableCell>\n                                                    {stock.quantite}\n                                                </TableCell>\n                                                <TableCell>\n                                                    {stock.numero_lot || '-'}\n                                                </TableCell>\n                                                <TableCell>\n                                                    {formatDate(stock.date_expiration)}\n                                                </TableCell>\n                                                <TableCell>\n                                                    {stock.prix_unitaire ? parseFloat(stock.prix_unitaire).toFixed(2) : '0.00'} FC\n\n                                                </TableCell>\n                                                <TableCell>\n                                                    {formatDate(stock.received_date)}\n                                                </TableCell>\n                                                \n                                                <TableCell>\n                                                    {getStatusBadge(stock.status)}\n                                                </TableCell>\n                                                <TableCell>\n                                                    <DropdownMenu\n                                                        open={openDropdownId === stock.ref}\n                                                        onOpenChange={(open) => {\n                                                            setOpenDropdownId(open ? stock.ref : null);\n                                                        }}\n                                                    >\n                                                        <DropdownMenuTrigger asChild>\n                                                            <Button\n                                                                variant=\"ghost\"\n                                                                className=\"h-8 w-8 p-0\"\n                                                                onClick={(e) => e.stopPropagation()}\n                                                            >\n                                                                <MoreHorizontal className=\"h-4 w-4\" />\n                                                            </Button>\n                                                        </DropdownMenuTrigger>\n                                                        <DropdownMenuContent\n                                                            align=\"end\"\n                                                            onInteractOutside={() => setOpenDropdownId(null)}\n                                                        >\n                                                            <DropdownMenuItem asChild>\n                                                                <Link\n                                                                    href={route('central-stocks.show', stock.ref)}\n                                                                    className=\"flex items-center\"\n                                                                    onClick={() => setOpenDropdownId(null)}\n                                                                >\n                                                                    <Eye className=\"mr-2 h-4 w-4\" />\n                                                                    Voir\n                                                                </Link>\n                                                            </DropdownMenuItem>\n                                                            <DropdownMenuItem asChild>\n                                                                <Link\n                                                                    href={route('central-stocks.edit', stock.ref)}\n                                                                    className=\"flex items-center\"\n                                                                    onClick={() => setOpenDropdownId(null)}\n                                                                >\n                                                                    <Pencil className=\"mr-2 h-4 w-4\" />\n                                                                    Modifier\n                                                                </Link>\n                                                            </DropdownMenuItem>\n                                                            <DropdownMenuItem\n                                                                className=\"text-red-600 focus:bg-red-50 focus:text-red-600\"\n                                                                onClick={(e) => {\n                                                                    e.preventDefault();\n                                                                    handleDelete(stock);\n                                                                    setOpenDropdownId(null);\n                                                                }}\n                                                            >\n                                                                <Trash2 className=\"mr-2 h-4 w-4\" />\n                                                                Supprimer\n                                                            </DropdownMenuItem>\n                                                        </DropdownMenuContent>\n                                                    </DropdownMenu>\n                                                </TableCell>\n                                            </TableRow>\n                                        ))\n                                    ) : (\n                                        <TableRow>\n                                            <TableCell colSpan={9} className=\"py-4 text-center\">\n                                                <div className=\"text-gray-500\">Aucune entrée de stock trouvée.</div>\n                                                <Button asChild variant=\"link\" className=\"mt-2\">\n                                                    <Link href={route('central-stocks.create')}>Ajouter une entrée</Link>\n                                                </Button>\n                                            </TableCell>\n                                        </TableRow>\n                                    )}\n                                </TableBody>\n                            </Table>\n                            </CardContent>\n                        </Card>\n                       \n                    </div>\n                </div>\n            </div>\n\n            <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Êtes-vous sûr ?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Cette action supprimera définitivement cette entrée de stock et ne pourra pas être annulée.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Annuler</AlertDialogCancel>\n                        <AlertDialogAction onClick={confirmDelete}>Supprimer</AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </AppLayout>\n    );\n}"],"names":["Index","stocks","produits","hopitals","auth","deleteDialogOpen","setDeleteDialogOpen","useState","stockToDelete","setStockToDelete","openDropdownId","setOpenDropdownId","breadcrumbs","handleDelete","stock","confirmDelete","router","toast","formatDate","dateString","format","fr","getProduitName","id","_a","p","getStatusBadge","status","jsxs","Badge","jsx","PackageCheck","Box","PackageX","canCreateStock","isAdminCentral","AppLayout","Head","Card","CardHeader","CardTitle","Button","Link","CardContent","Table","TableHeader","TableRow","TableHead","TableBody","TableCell","DropdownMenu","open","DropdownMenuTrigger","e","MoreHorizontal","DropdownMenuContent","DropdownMenuItem","Eye","Pencil","Trash2","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction"],"mappings":"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"}