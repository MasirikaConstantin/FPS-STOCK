{"version":3,"file":"Index copy-ChYS2PHx.js","sources":["../../../resources/js/pages/Stocks/Index copy.tsx"],"sourcesContent":["import {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from '@/components/ui/alert-dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from '@/components/ui/dropdown-menu';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport AppLayout from '@/layouts/app-layout';\nimport { BreadcrumbItem, User } from '@/types';\nimport { App, PageProps } from '@/types/types';\nimport { Head, Link, router } from '@inertiajs/react';\nimport { Eye, MoreHorizontal, Pencil, Trash2, Box, PackageCheck, PackageX } from 'lucide-react';\nimport { useState } from 'react';\nimport { toast } from 'sonner';\nimport { format } from 'date-fns';\nimport { fr } from 'date-fns/locale';\n\nexport default function Index({ stocks, produits, hopitals, auth }: PageProps<{ \n    stocks: App.Stock[],\n    produits: App.MedicalProduit[],\n    hopitals: App.Hopital[],\n    auth: User\n}>) {\n    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n    const [stockToDelete, setStockToDelete] = useState<App.Stock | null>(null);\n    const [openDropdownId, setOpenDropdownId] = useState<string | null>(null);\n    const canCreateStock = auth.user.permissions.some(p => p.action === 'create' && p.module === 'stocks');\n    const canUpdateStock = auth.user.permissions.some(p => p.action === 'update' && p.module === 'stocks');\n    const canDeleteStock = auth.user.permissions.some(p => p.action === 'delete' && p.module === 'stocks');\n\n    const isAdminCentral = auth.user.role === 'admin_central';\n    const isAdmin = auth.user.role === 'admin';\n    const breadcrumbs: BreadcrumbItem[] = [\n        {\n            title: 'Gestion des Stocks',\n            href: '/stocks',\n        },\n    ];\n\n    const handleDelete = (stock: App.Stock) => {\n        setStockToDelete(stock);\n        setDeleteDialogOpen(true);\n        setOpenDropdownId(null);\n    };\n\n    const confirmDelete = () => {\n        if (!stockToDelete) return;\n\n        router.delete(route('stocks.destroy', stockToDelete.ref), {\n            preserveScroll: true,\n            onSuccess: () => {\n                toast.success('Entrée de stock supprimée avec succès');\n                setDeleteDialogOpen(false);\n            },\n            onError: () => {\n                toast.error('Une erreur est survenue lors de la suppression');\n            },\n            onFinish: () => {\n                setOpenDropdownId(null);\n            },\n        });\n    };\n\n    const formatDate = (dateString: string | null) => {\n        if (!dateString) return '-';\n        return format(new Date(dateString), 'dd MMM yyyy', { locale: fr });\n    };\n\n    const getProduitName = (id: number) => {\n        return produits.find(p => p.id === id)?.name || 'Inconnu';\n    };\n\n    const getHopitalName = (id: number | null) => {\n        if (!id) return 'Stock central';\n        return hopitals.find(h => h.id === id)?.nom || 'Inconnu';\n    };\n\n    const getStatusBadge = (status: string) => {\n        switch (status) {\n            case 'disponible':\n                return <Badge variant=\"default\"><PackageCheck className=\"mr-1 h-3 w-3\" /> Disponible</Badge>;\n            case 'reservee':\n                return <Badge variant=\"secondary\"><Box className=\"mr-1 h-3 w-3\" /> Réservée</Badge>;\n            case 'expirer':\n                return <Badge variant=\"destructive\"><PackageX className=\"mr-1 h-3 w-3\" /> Expiré</Badge>;\n            case 'endommage':\n                return <Badge variant=\"destructive\">Endommagé</Badge>;\n            default:\n                return <Badge variant=\"outline\">Inconnu</Badge>;\n        }\n    };\n\n    return (\n        <AppLayout breadcrumbs={breadcrumbs}>\n            <Head title=\"Gestion des Stocks\" />\n\n            <div className=\"py-12\">\n                <div className=\"mx-auto max-w-7xl sm:px-6 lg:px-8\">\n                    <div className=\"overflow-hidden shadow-sm sm:rounded-lg\">\n                        <div className=\"p-6\">\n                            <div className=\"flex justify-between items-center mb-6\">\n                                <h1 className=\"text-2xl font-bold\">Gestion des Stocks</h1>\n                                {canCreateStock ? (\n                                    <Button asChild>\n                                        <Link href={route('stocks.create')}>Ajouter une entrée</Link>\n                                    </Button>\n                                ) : \n                                isAdminCentral ? (\n                                    <div className=\"text-red-500 text-sm font-bold w-1/2\">\n                                        <p>Vous êtes connecté en tant qu'admin central, Mais ne pouvez pas créer des stocks, vous devez ajouter des permissions pour y accéder</p>\n                                    </div>\n                                ) : \n                                isAdmin ? (\n                                        <div className=\"text-red-500 text-sm font-bold w-1/2\">\n                                            <p>Vous êtes connecté en tant qu'admin, Mais ne pouvez pas créer des stocks, vous devez ajouter des permissions pour y accéder</p>\n                                        </div>\n                                ) : null}\n                                \n                            </div>\n\n                            <Table className=\"dark:text-gray-400cell w-full text-left text-sm text-gray-500 rtl:text-right\">\n                                <TableHeader>\n                                    <TableRow>\n                                        <TableHead>Produit</TableHead>\n                                        <TableHead>Quantité</TableHead>\n                                        <TableHead>Numéro de lot</TableHead>\n                                        <TableHead>Date expiration</TableHead>\n                                        <TableHead>Prix unitaire</TableHead>\n                                        <TableHead>Date réception</TableHead>\n                                        <TableHead>Emplacement</TableHead>\n                                        <TableHead>Statut</TableHead>\n                                        <TableHead>Actions</TableHead>\n                                    </TableRow>\n                                </TableHeader>\n                                <TableBody>\n                                    {stocks && stocks.length > 0 ? (\n                                        stocks.map((stock) => (\n                                            <TableRow key={stock.id}>\n                                                <TableCell className=\"font-medium text-black dark:text-white\">\n                                                    {getProduitName(stock.medical_produit_id)}\n                                                </TableCell>\n                                                <TableCell>\n                                                    {stock.quantite}\n                                                </TableCell>\n                                                <TableCell>\n                                                    {stock.numero_lot || '-'}\n                                                </TableCell>\n                                                <TableCell>\n                                                    {formatDate(stock.date_expiration)}\n                                                </TableCell>\n                                                <TableCell>\n                                                    {stock.prix_unitaire ? parseFloat(stock.prix_unitaire).toFixed(2) : '0.00'} FC\n\n                                                </TableCell>\n                                                <TableCell>\n                                                    {formatDate(stock.received_date)}\n                                                </TableCell>\n                                                <TableCell>\n                                                    {getHopitalName(stock.hopital_id)}\n                                                </TableCell>\n                                                <TableCell>\n                                                    {getStatusBadge(stock.status)}\n                                                </TableCell>\n                                                <TableCell>\n                                                    <DropdownMenu\n                                                        open={openDropdownId === stock.ref}\n                                                        onOpenChange={(open) => {\n                                                            setOpenDropdownId(open ? stock.ref : null);\n                                                        }}\n                                                    >\n                                                        <DropdownMenuTrigger asChild>\n                                                            <Button\n                                                                variant=\"ghost\"\n                                                                className=\"h-8 w-8 p-0\"\n                                                                onClick={(e) => e.stopPropagation()}\n                                                            >\n                                                                <MoreHorizontal className=\"h-4 w-4\" />\n                                                            </Button>\n                                                        </DropdownMenuTrigger>\n                                                        <DropdownMenuContent\n                                                            align=\"end\"\n                                                            onInteractOutside={() => setOpenDropdownId(null)}\n                                                        >\n                                                            <DropdownMenuItem asChild>\n                                                                <Link\n                                                                    href={route('stocks.show', stock.ref)}\n                                                                    className=\"flex items-center\"\n                                                                    onClick={() => setOpenDropdownId(null)}\n                                                                >\n                                                                    <Eye className=\"mr-2 h-4 w-4\" />\n                                                                    Voir\n                                                                </Link>\n                                                            </DropdownMenuItem>\n                                                            <DropdownMenuItem asChild>\n                                                                <Link\n                                                                    href={route('stocks.edit', stock.ref)}\n                                                                    className=\"flex items-center\"\n                                                                    onClick={() => setOpenDropdownId(null)}\n                                                                >\n                                                                    <Pencil className=\"mr-2 h-4 w-4\" />\n                                                                    Modifier\n                                                                </Link>\n                                                            </DropdownMenuItem>\n                                                            <DropdownMenuItem\n                                                                className=\"text-red-600 focus:bg-red-50 focus:text-red-600\"\n                                                                onClick={(e) => {\n                                                                    e.preventDefault();\n                                                                    handleDelete(stock);\n                                                                    setOpenDropdownId(null);\n                                                                }}\n                                                            >\n                                                                <Trash2 className=\"mr-2 h-4 w-4\" />\n                                                                Supprimer\n                                                            </DropdownMenuItem>\n                                                        </DropdownMenuContent>\n                                                    </DropdownMenu>\n                                                </TableCell>\n                                            </TableRow>\n                                        ))\n                                    ) : (\n                                        <TableRow>\n                                            <TableCell colSpan={9} className=\"py-4 text-center\">\n                                                <div className=\"text-gray-500\">Aucune entrée de stock trouvée.</div>\n                                                <Button asChild variant=\"link\" className=\"mt-2\">\n                                                    <Link href={route('stocks.create')}>Ajouter une entrée</Link>\n                                                </Button>\n                                            </TableCell>\n                                        </TableRow>\n                                    )}\n                                </TableBody>\n                            </Table>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Êtes-vous sûr ?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Cette action supprimera définitivement cette entrée de stock et ne pourra pas être annulée.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Annuler</AlertDialogCancel>\n                        <AlertDialogAction onClick={confirmDelete}>Supprimer</AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </AppLayout>\n    );\n}"],"names":["Index","stocks","produits","hopitals","auth","deleteDialogOpen","setDeleteDialogOpen","useState","stockToDelete","setStockToDelete","openDropdownId","setOpenDropdownId","canCreateStock","p","isAdminCentral","isAdmin","breadcrumbs","handleDelete","stock","confirmDelete","router","toast","formatDate","dateString","format","fr","getProduitName","id","_a","getHopitalName","h","getStatusBadge","status","jsxs","Badge","jsx","PackageCheck","Box","PackageX","AppLayout","Head","Button","Link","Table","TableHeader","TableRow","TableHead","TableBody","TableCell","DropdownMenu","open","DropdownMenuTrigger","e","MoreHorizontal","DropdownMenuContent","DropdownMenuItem","Eye","Pencil","Trash2","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction"],"mappings":"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"}